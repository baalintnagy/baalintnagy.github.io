<!DOCTYPE html>
<html lang="en">
<head>
    <title>Bálint Nagy CV</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Bálint Nagy CV - Senior Software Engineer">
    <meta name="author" content="Bálint Nagy">
    
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    
    <!-- Modern CV Styles -->
    <link rel="stylesheet" href="assets/css/modern-cv.css">
    <link rel="stylesheet" href="assets/css/theme-switcher.css">
</head>
<body>
    <div id="cv-app">
        <div class="loading">
            <i class="bi bi-hourglass-split"></i>
            <p>Loading CV...</p>
        </div>
    </div>

    <!-- Template Engine -->
    <script src="assets/js/template-engine.js"></script>
    
    <!-- Theme Switcher -->
    <script src="assets/js/theme-switcher.js"></script>

    <!-- Auxiliary scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=AM_CHTML"></script>
    <script src="assets/js/script.js"></script>
    
    <!-- CV Application -->
    <script>
        async function load_CV_JSON_Data(filePath) {
            try {
                const response = await fetch(filePath);
                if (!response.ok) {
                    throw new Error(`Failed to load CV data: ${response.status} ${response.statusText}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Error loading CV data:', error);
                throw error;
            }
        }

        // Fallback CV data for when fetch fails - generic template filler
        const fallbackCVData = {
            "meta": {
                "source": {
                    "type": "html",
                    "title": "John Doe CV"
                }
            },
            "basics": {
                "name": "John Doe",
                "label": "Senior Janitor Intern",
                "image": "https://upload.wikimedia.org/wikipedia/commons/thumb/2/28/Albert_Einstein_Head_cleaned.jpg/500px-Albert_Einstein_Head_cleaned.jpg?20251103195240",
                "website": "https://acme.acme",
                "email": "johnny1988@acme.acme",
                "phone": "+36 20 123 4567",
                "profiles": [
                    {
                        "network": "LinkedIn",
                        "url": "https://www.linkedin.com/in/404"
                    },
                    {
                        "network": "GitHub",
                        "url": "https://github.com/404"
                    },
                    {
                        "network": "GitLab",
                        "url": "https://gitlab.com/404"
                    }
                ]
            },
            "summary": [
                "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer vel augue nec justo facilisis tristique. Sed non sem at sapien suscipit ullamcorper. Cras non purus vitae lacus pulvinar varius. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Suspendisse potenti. Nulla facilisi. Donec sed nisl eu libero aliquet gravida. Mauris in mi non ipsum sagittis laoreet. Proin a sem nec tortor hendrerit fermentum. Curabitur at lacus non nulla commodo tincidunt. Aliquam erat volutpat."
            ],
            "work": [
                {
                    "company": "Tech Company",
                    "position": "Janitor",
                    "start": "2020",
                    "end": "Present",
                    "highlights": [
                        "Phasellus vitae nunc at arcu luctus dignissim. Praesent ut dui nec erat cursus bibendum. Nam feugiat, lectus et aliquet luctus, justo lorem pharetra purus, vitae tincidunt justo nibh eget neque. Integer dictum urna sed sapien hendrerit, a interdum velit dictum. Morbi et urna ut libero luctus tristique. Aenean finibus, erat vitae dapibus fermentum, neque odio efficitur lorem, non hendrerit risus arcu sit amet erat. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas."
                    ],
                    "technologies": ["Mop", "Bucket", "Broom"]
                }
            ],
            "skills": {
                "technical": [
                    {
                        "group": "Janitor utilities",
                        "items": [
                            {"name": "Mop", "proficiencyPercent": 80},
                            {"name": "Bucket", "proficiencyPercent": 75},
                            {"name": "Broom", "proficiencyPercent": 70}
                        ]
                    },
                    {
                        "group": "Auxiliari facilities",
                        "items": [
                            {"name": "Vacuum cleaner", "proficiencyPercent": 85},
                            {"name": "Sponges", "proficiencyPercent": 70},
                            {"name": "Dustpan", "proficiencyPercent": 65}
                        ]
                    }
                ],
                "soft": [
                    "Problem Solving",
                    "Teamwork",
                    "Communication",
                    "Adaptability"
                ]
            },
            "education": [
                {
                    "institution": "University of Life",
                    "area": "Janitor course",
                    "studyType": "PhD",
                    "start": "2010",
                    "end": "2020"
                }
            ],
            "languages": [
                {
                    "language": "Irish [drunken]",
                    "fluency": "native",
                    "indicator": {"full": 10, "half": 0, "empty": 0, "scale": 10}
                },
                {
                    "language": "English",
                    "fluency": "intermediate",
                    "indicator": {"full": 6, "half": 1, "empty": 3, "scale": 10}
                }
            ],
            "extras": {
                "footerLink": {
                    "label": "Portfolio",
                    "url": "https://acme.acme"
                }
            }
        };

        class CVApplication {
            constructor() {
                this.templateEngine = new CVTemplateEngine();
                this.cvData = null;
                this.init();
            }

            async init() {
                try {
                    await this.loadCVData();
                    this.renderCV();
                    this.hideLoading();
                } catch (error) {
                    this.showError(error);
                }
            }

            async loadCVData() {
                // Load CV data using the fetch-based function
                try {
                    this.cvData = await load_CV_JSON_Data('/data/cv.json');
                    console.log('Loaded CV data from file');
                } catch (error) {
                    console.log('Could not load from file, using fallback data');
                    // Fallback to embedded data if fetch fails
                    this.cvData = fallbackCVData;
                }
            }

            renderCV() {
                const container = document.getElementById('cv-app');
                this.templateEngine.render(this.cvData, container);
                
                // Add some animation to skill bars
                this.animateSkillBars();
                
                // Setup profile picture switching
                this.setupProfilePictureSwitch();
            }

            animateSkillBars() {
                const skillBars = document.querySelectorAll('.skill-progress');
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const width = entry.target.style.width;
                            entry.target.style.width = '0%';
                            setTimeout(() => {
                                entry.target.style.width = width;
                            }, 100);
                            observer.unobserve(entry.target);
                        }
                    });
                });

                skillBars.forEach(bar => observer.observe(bar));
            }

            setupProfilePictureSwitch() {
                const profileImage = document.querySelector('.profile-image');
                if (!profileImage) return;

                const images = ['assets/images/profile.png', 'assets/images/profile.jpeg'];
                let currentIndex = 0;

                profileImage.style.cursor = 'pointer';
                profileImage.title = 'Click to switch profile picture';

                profileImage.addEventListener('click', () => {
                    currentIndex = (currentIndex + 1) % images.length;
                    profileImage.style.opacity = '0';
                    
                    setTimeout(() => {
                        profileImage.src = images[currentIndex];
                        profileImage.style.opacity = '1';
                    }, 150);
                });
            }

            hideLoading() {
                const loading = document.querySelector('.loading');
                if (loading) {
                    loading.style.display = 'none';
                }
            }

            showError(error) {
                const container = document.getElementById('cv-app');
                container.innerHTML = `
                    <div class="error">
                        <i class="bi bi-exclamation-triangle"></i>
                        <h2>Error Loading CV</h2>
                        <p>${error.message}</p>
                        <button onclick="location.reload()">Try Again</button>
                    </div>
                `;
            }
        }

        // Initialize the application when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            new CVApplication();
        });
    </script>

    <style>
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            color: var(--text-secondary);
        }

        .loading i {
            font-size: 3rem;
            margin-bottom: 1rem;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .error {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            text-align: center;
            color: var(--text-secondary);
        }

        .error i {
            font-size: 3rem;
            color: #dc3545;
            margin-bottom: 1rem;
        }

        .error h2 {
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .error button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        .error button:hover {
            background: #1e40af;
        }

        .profile-image {
            transition: opacity 0.15s ease-in-out;
        }
    </style>
</body>
</html>
